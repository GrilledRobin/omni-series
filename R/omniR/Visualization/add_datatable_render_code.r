#---------------------------------------------------------------------------------------------------------------------------------------#
#100.   Introduction.                                                                                                                   #
#---------------------------------------------------------------------------------------------------------------------------------------#
#   |This function is intended to add static render callback to a [DT::datatable] object                                                #
#   |-----------------------------------------------------------------------------------------------------------------------------------#
#   |[Quote]                                                                                                                            #
#   |-----------------------------------------------------------------------------------------------------------------------------------#
#   |[01] https://github.com/rstudio/DT/issues/410                                                                                      #
#   |-----------------------------------------------------------------------------------------------------------------------------------#
#   |[IMPORTANT]                                                                                                                        #
#   |-----------------------------------------------------------------------------------------------------------------------------------#
#   |[01] This is one of the helper functions that enables one to insert [htmlwidget] into cells of [DT::datatable]                     #
#   |-----------------------------------------------------------------------------------------------------------------------------------#
#   |[Method to insert htmlwidgets into datatable]                                                                                      #
#   |-----------------------------------------------------------------------------------------------------------------------------------#
#   |[10] Convert htmlwidget into character version; using function [as.character.htmlwidget]                                           #
#   |[20] Make sure [escape = FALSE]                                                                                                    #
#   |[30] Add static render callback; using function [add_datatable_render_code]                                                        #
#   |[40] Add dependencies for the htmlwidget being used; using function [add_deps]                                                     #
#---------------------------------------------------------------------------------------------------------------------------------------#
#200.   Glossary.                                                                                                                       #
#---------------------------------------------------------------------------------------------------------------------------------------#
#   |100.   Parameters.                                                                                                                 #
#   |-----------------------------------------------------------------------------------------------------------------------------------#
#   |dtbl        :   The [DT::datatable] object to which to add the callback                                                            #
#   |-----------------------------------------------------------------------------------------------------------------------------------#
#   |900.   Return Values by position.                                                                                                  #
#   |-----------------------------------------------------------------------------------------------------------------------------------#
#   |<datatable> :   The [DT::datatable] object with the added callback                                                                 #
#---------------------------------------------------------------------------------------------------------------------------------------#
#300.   Update log.                                                                                                                     #
#---------------------------------------------------------------------------------------------------------------------------------------#
#   | Date |    20211208        | Version | 1.00        | Updater/Creator | Lu Robin Bin                                                #
#   |______|____________________|_________|_____________|_________________|_____________________________________________________________#
#   | Log  |Version 1.                                                                                                                  #
#   |______|____________________________________________________________________________________________________________________________#
#---------------------------------------------------------------------------------------------------------------------------------------#
#400.   User Manual.                                                                                                                    #
#---------------------------------------------------------------------------------------------------------------------------------------#
#   |See the [Full Test Program] section                                                                                                #
#---------------------------------------------------------------------------------------------------------------------------------------#
#500.   Dependent Facilities.                                                                                                           #
#---------------------------------------------------------------------------------------------------------------------------------------#
#   |100.   Dependent Modules                                                                                                           #
#   |-----------------------------------------------------------------------------------------------------------------------------------#
#   |   |htmlwidgets                                                                                                                    #
#   |-----------------------------------------------------------------------------------------------------------------------------------#
#   |300.   Dependent functions                                                                                                         #
#   |-----------------------------------------------------------------------------------------------------------------------------------#
#---------------------------------------------------------------------------------------------------------------------------------------#

#001. Append the list of required packages to the global environment
#Below expression is used for easy copy-paste from raw text strings instead of quoted ones.
lst_pkg <- deparse(substitute(c(
	htmlwidgets
)))
#Quote: https://www.regular-expressions.info/posixbrackets.html?wlr=1
lst_pkg <- paste0(lst_pkg, collapse = '')
lst_pkg <- gsub('[[:space:]]', '', lst_pkg, perl = T)
lst_pkg <- gsub('^c\\((.+)\\)', '\\1', lst_pkg, perl = T)
lst_pkg <- unlist(strsplit(lst_pkg, ',', perl = T))
options( omniR.req.pkg = base::union(getOption('omniR.req.pkg'), lst_pkg) )

add_datatable_render_code <- function(dtbl) {
	render_js_code <- htmlwidgets::JS('function(){HTMLWidgets.staticRender();}')

	dtbl$x$options$fnDrawCallback <- render_js_code
	return(dtbl)
}

#[Full Test Program;]
if (FALSE){
	#Real case test
	if (TRUE){
		#100. Prepare the [datatable] object
		m <- data.frame(a = 1, b = 2, c = 3)
		dt <- datatable(m)

		#200. Add callback to it
		dt_with_cb <- add_datatable_render_code(dt)

	}
}
